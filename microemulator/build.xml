<?xml version="1.0" encoding="UTF-8"?>
<!-- Written to assume that classpath is rooted in the current directory. -->
<!-- So this should be OK if you make this script in the root of a filesystem. -->
<!-- If not, you may prefer to adjust the basedir, or move some directories around. -->
<!-- The idea is that both Ant and NetBeans have to know what the package root is -->
<!-- for the classes in your application. -->
<project basedir="." default="run" name="microemulator">

  <target name="init">
    <!-- You can set up any variables you want used throughout the script here. -->
    <!-- To use e.g. Jikes, uncomment this line. -->
    <!-- (Or make the same change in Tools | Options | Ant Settings | Properties.) -->
    <!-- <property name="build.compiler" value="jikes"/> -->
    <!-- You might like to set up some overridable paths, etc.: -->
    <!-- <property name="mylib" value="../lib/mylib.jar"/> -->
  </target>

  <target depends="init" name="compile">
    <mkdir dir="./build/microemulator/classes"/>
    <javac debug="true" deprecation="true" destdir="./build/microemulator/classes" srcdir="./src">
      <classpath>
        <pathelement location="./lib/jnlp.jar"/>
      </classpath>      
    </javac>
  </target>

  <target depends="init,compile" name="jar-simpledemo">
    <jar compress="true" jarfile="simpledemo.jar">
      <fileset dir="./build/microemulator/classes">
        <include name="com/barteo/midp/examples/simpledemo/**"/>
        <exclude name="**/.*"/>
      </fileset>
      <fileset dir="./res">
        <include name="com/barteo/midp/examples/simpledemo/**"/>
        <exclude name="**/.*"/>
      </fileset>
    </jar>
    <copy file="simpledemo.jar" todir="doc/www"/>
  </target>

  <target depends="init,compile" name="jar-applet">
    <jar compress="true" jarfile="me-applet.jar">
      <fileset dir="./build/microemulator/classes">
        <exclude name="com/barteo/midp/examples/**"/>
        <exclude name="com/barteo/emulator/app/**"/>
        <exclude name="com/barteo/emulator/device/j2se/**"/>
        <exclude name="**/.*"/>
      </fileset>
      <fileset dir="./res">
        <exclude name="com/barteo/midp/examples/**"/>
        <exclude name="**/.*"/>
      </fileset>
    </jar>
    <copy file="me-applet.jar" todir="doc/www"/>
  </target>

  <target depends="init,compile,jar-applet,jar-simpledemo" name="jar-app">
    <jar compress="true" jarfile="me-app.jar">
      <fileset dir="./build/microemulator/classes">
        <exclude name="com/barteo/midp/examples/**"/>
        <exclude name="com/barteo/emulator/applet/**"/>
        <exclude name="com/barteo/emulator/device/applet/**"/>
        <exclude name="**/.*"/>
      </fileset>
      <fileset dir="./res">
        <exclude name="com/barteo/midp/examples/**"/>
        <exclude name="**/.*"/>
      </fileset>
    </jar>
  </target>

  <target depends="init,jar-app" description="Build everything." name="all">
  </target>

  <target depends="init,all" description="Try running it." name="run">
    <java classname="com.barteo.emulator.app.Main" failonerror="true" fork="true">
      <classpath>
        <pathelement location="me-app.jar"/>
        <pathelement location="simpledemo.jar"/>
      </classpath>
      <arg value="com.barteo.midp.examples.simpledemo.SimpleDemo"/>
    </java>
  </target>

  <target depends="jar-app" description="Create minimum device" name="compile-device">
    <mkdir dir="./build/devices/j2se/minimum/classes"/>
    <javac debug="true" deprecation="true" 
        srcdir="./devices/j2se/minimum/java"
        destdir="./build/devices/j2se/minimum/classes">
      <classpath>
        <pathelement location="./me-app.jar"/>
      </classpath>      
    </javac>
  </target>

  <target depends="compile-device" description="Package minimum device" name="jar-device">
    <jar compress="true" jarfile="./minimum.dev" manifest="./devices/j2se/minimum/manifest.mf">
      <fileset dir="./build/devices/j2se/minimum/classes"/>
      <fileset dir="./devices/j2se/minimum/res"/>
    </jar>
  </target>

  <target depends="init,jar-app,jar-device" description="Create distribution package" name="dist">
    <mkdir dir="dist"/>

    <tar basedir="../." tarfile="dist/microemulator-src.tar">
      <exclude name="microemulator/**/.*"/>
      <exclude name="microemulator/*.jar"/>
      <exclude name="microemulator/build/**"/>
      <exclude name="microemulator/dist/*"/>
      <exclude name="microemulator/doc/**"/>
    </tar>
    <gzip src="dist/microemulator-src.tar" zipfile="dist/microemulator-src.tar.gz"/>
    <delete file="dist/microemulator-src.tar"/>

    <tar basedir="../." tarfile="dist/microemulator-applet.tar">
      <exclude name="microemulator/**/.*"/>
      <exclude name="microemulator/build.xml"/>
      <exclude name="microemulator/me-app.jar"/>
      <exclude name="microemulator/build/**"/>
      <exclude name="microemulator/dist/*"/>
      <exclude name="microemulator/doc/**"/>
      <exclude name="microemulator/lib/**"/>
      <exclude name="microemulator/res/**"/>
      <exclude name="microemulator/src/**"/>
    </tar>
    <gzip src="dist/microemulator-applet.tar" zipfile="dist/microemulator-applet.tar.gz"/>
    <delete file="dist/microemulator-applet.tar"/>

    <tar basedir="../." tarfile="dist/microemulator-app.tar">
      <exclude name="microemulator/**/.*"/>
      <exclude name="microemulator/build.xml"/>
      <exclude name="microemulator/me-applet.jar"/>
      <exclude name="microemulator/build/**"/>
      <exclude name="microemulator/dist/*"/>
      <exclude name="microemulator/doc/**"/>
      <exclude name="microemulator/lib/**"/>
      <exclude name="microemulator/res/**"/>
      <exclude name="microemulator/src/**"/>
    </tar>
    <gzip src="dist/microemulator-app.tar" zipfile="dist/microemulator-app.tar.gz"/>
    <delete file="dist/microemulator-app.tar"/>
  </target>

  <target depends="init" description="Clean all build products." name="clean">
    <delete dir="./build"/>
    <delete file="me-app.jar"/>
    <delete file="me-applet.jar"/>
    <delete file="simpledemo.jar"/>
    <delete dir="apidoc"/>
    <delete dir="dist"/>
  </target>

</project>
